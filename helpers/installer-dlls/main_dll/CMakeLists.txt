cmake_minimum_required(VERSION 2.6)

SET(TARGET main_dll)
	
PROJECT(${TARGET})

SET(SRCS
	${TARGET}.cpp
	${NSCP_INCLUDEDIR}/ServiceCmd.cpp
)

ADD_DEFINITIONS(${NSCP_GLOBAL_DEFINES})

IF(WIN32)
	SET(SRCS ${SRCS}
		"${TARGET}.def"
		installer_helper.hpp
		${NSCP_INCLUDEDIR}/ServiceCmd.h
	)
ENDIF(WIN32)
IF(NOT MSVC11 AND NOT MSVC10)
	IF(NOT CMAKE_CL_64)
		INCLUDE_DIRECTORIES(${PSDK_2003_INCLUDE_DIRS})
		LINK_DIRECTORIES(${PSDK_2003_LIBRARY_DIRS})
	ENDIF(NOT CMAKE_CL_64)
	SET(EXTRA_LIBS bufferoverflowu.lib)
ENDIF(NOT MSVC11 AND NOT MSVC10)

ADD_LIBRARY(${TARGET} MODULE ${SRCS})
if (MSVC11)
	SET_TARGET_PROPERTIES(${TARGET} PROPERTIES LIBRARY_OUTPUT_DIRECTORY ${BUILD_TARGET_INSTLIB_PATH})
	SET_TARGET_PROPERTIES(${TARGET} PROPERTIES LIBRARY_OUTPUT_DIRECTORY_DEBUG ${BUILD_TARGET_INSTLIB_PATH})
	SET_TARGET_PROPERTIES(${TARGET} PROPERTIES LIBRARY_OUTPUT_DIRECTORY_RELEASE ${BUILD_TARGET_INSTLIB_PATH})
	SET_TARGET_PROPERTIES(${TARGET} PROPERTIES LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO ${BUILD_TARGET_INSTLIB_PATH})
endif(MSVC11)

TARGET_LINK_LIBRARIES(${TARGET}
	${Boost_FILESYSTEM_LIBRARY}
	${Boost_SYSTEM_LIBRARY}
	${EXTRA_LIBS}
	Msi.lib
	settings_manager
)

SET_TARGET_PROPERTIES(${TARGET} PROPERTIES FOLDER "installer-dll")
